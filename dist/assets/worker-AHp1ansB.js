var C=l=>{throw TypeError(l)};var F=(l,i,a)=>i.has(l)||C("Cannot "+a);var e=(l,i,a)=>(F(l,i,"read from private field"),a?a.call(l):i.get(l)),b=(l,i,a)=>i.has(l)?C("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(l):i.set(l,a),m=(l,i,a,v)=>(F(l,i,"write to private field"),v?v.call(l,a):i.set(l,a),a),w=(l,i,a)=>(F(l,i,"access private method"),a);var y=(l,i,a,v)=>({set _(p){m(l,i,p,a)},get _(){return e(l,i,v)}});(function(){"use strict";var f,t,z,g,T,M,A;var l=(o=>(o.Landscape="landscape",o.Portrait="portrait",o.Square="square",o))(l||{}),i=(o=>(o.AzioneInteressePubblico="azione-interesse-pubblico",o.AzioneInterna="azione-interna",o.AzioneInternazionale="azione-internazionale",o.AzioneNuoveGenerazioni="azione-nuove-generazioni",o.AzioneProfessionale="azione-professionale",o.Cultura="cultura",o.Distretto="distretto",o.Doc="doc",o.Etruria="etruria",o.FondazioneRotary="fondazione-rotary",o.Galileo="galileo",o.Magnifico="magnifico",o.Montalbano="montalbano",o.Sport="sport",o.Tirreno="tirreno",o))(i||{}),a={frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,strokeWidth:8}},colors:{[i.AzioneInteressePubblico]:"#d41367",[i.AzioneInterna]:"#d41367",[i.AzioneInternazionale]:"#d41367",[i.AzioneNuoveGenerazioni]:"#d41367",[i.AzioneProfessionale]:"#d41367",[i.Cultura]:"#d41367",[i.Distretto]:"#17458f",[i.Doc]:"#0067c8",[i.Etruria]:"#00adbb",[i.FondazioneRotary]:"#d41367",[i.Galileo]:"#f7a81b",[i.Magnifico]:"#009739",[i.Montalbano]:"#901f93",[i.Sport]:"#d41367",[i.Tirreno]:"#ff7600"},hashes:{frames:{[l.Landscape]:"28846",[l.Portrait]:"18461",[l.Square]:"24840"},logos:{[i.AzioneInteressePubblico]:"12481",[i.AzioneInterna]:"07462",[i.AzioneInternazionale]:"62091",[i.AzioneNuoveGenerazioni]:"28340",[i.AzioneProfessionale]:"32990",[i.Cultura]:"57135",[i.Distretto]:"01940",[i.Doc]:"20572",[i.Etruria]:"25935",[i.FondazioneRotary]:"41211",[i.Galileo]:"28425",[i.Magnifico]:"54002",[i.Montalbano]:"03570",[i.Sport]:"32507",[i.Tirreno]:"48765"}}};function v(){return typeof OffscreenCanvas<"u"}function p(o,h){if(v())return new OffscreenCanvas(o,h);const u=document.createElement("canvas");return u.width=o,u.height=h,u}const P=q();async function I(o,h,u,n,r,s){const d=new x(o,h);d.drawImage(u),d.drawFrame(n,r);const c=s.length===1?[s[0],s[0]]:s;for(const S of c)d.drawLogo(S,r??a.colors[i.Distretto]);return new URL(URL.createObjectURL(await d.getBlobAndDestroy()))}class x{constructor(h,u){b(this,g);b(this,f);b(this,t);b(this,z,0);m(this,f,p(h,u));const n=e(this,f).getContext("2d");if(!n)throw new Error("Canvas 2D rendering context not supported");m(this,t,n)}drawImage(h){const n=a.frame.border+20,r=a.frame.border+20,s=e(this,f).width-(a.frame.border+20)*2,d=e(this,f).height-(a.frame.border+20)*2,c=30;e(this,t).save(),e(this,t).fillStyle="#FFFFFF",e(this,t).fillRect(0,0,e(this,f).width,e(this,f).height),e(this,t).restore(),e(this,t).save(),e(this,t).beginPath(),e(this,t).moveTo(n+c,r),e(this,t).lineTo(n+s-c,r),e(this,t).quadraticCurveTo(n+s,r,n+s,r+c),e(this,t).lineTo(n+s,r+d-c),e(this,t).quadraticCurveTo(n+s,r+d,n+s-c,r+d),e(this,t).lineTo(n+c,r+d),e(this,t).quadraticCurveTo(n,r+d,n,r+d-c),e(this,t).lineTo(n,r+c),e(this,t).quadraticCurveTo(n,r,n+c,r),e(this,t).closePath(),e(this,t).fillStyle="#FFFFFF",e(this,t).fill(),e(this,t).restore(),e(this,t).save(),e(this,t).beginPath(),e(this,t).moveTo(n+c,r),e(this,t).lineTo(n+s-c,r),e(this,t).quadraticCurveTo(n+s,r,n+s,r+c),e(this,t).lineTo(n+s,r+d-c),e(this,t).quadraticCurveTo(n+s,r+d,n+s-c,r+d),e(this,t).lineTo(n+c,r+d),e(this,t).quadraticCurveTo(n,r+d,n,r+d-c),e(this,t).lineTo(n,r+c),e(this,t).quadraticCurveTo(n,r,n+c,r),e(this,t).closePath(),e(this,t).clip(),e(this,t).drawImage(h,n,r,s,d),e(this,t).restore()}drawFrame(h,u){for(const n of h.paths)e(this,t).fillStyle=u!==null&&n.customizable?u:n.fill,e(this,t).fill(new Path2D(n.definition))}drawLogo(h,u){const[n,r]=w(this,g,T).call(this),[s,d]=w(this,g,M).call(this,n,r);w(this,g,A).call(this,s,d,u),e(this,t).drawImage(h,s,d,a.logo.image.side,a.logo.image.side),y(this,z)._++}async getBlobAndDestroy(){const h=e(this,f);if(v()&&h instanceof OffscreenCanvas)return h.convertToBlob();if(h instanceof HTMLCanvasElement)return new Promise((u,n)=>{h.toBlob(r=>{if(!r){n(new Error("Canvas.toBlob returned null"));return}h.remove(),u(r)})});throw new Error("Unsupported canvas type")}}f=new WeakMap,t=new WeakMap,z=new WeakMap,g=new WeakSet,T=function(){switch(e(this,z)){case 0:return[-1,1];case 1:return[1,-1];default:const h=-Math.PI/4-Math.PI/2*e(this,z);return[Math.cos,Math.sin].map(u=>Math.sign(u(h)))}},M=function(h,u){const n=a.frame.border+a.logo.circle.margin,r=a.logo.image.side,s=h<0?n:e(this,f).width-n-r,d=u>0?n:e(this,f).height-n-r;return[s,d]},A=function(h,u,n){const r=h+a.logo.image.side/2,s=u+a.logo.image.side/2;e(this,t).beginPath(),e(this,t).arc(r,s,P+a.logo.circle.strokeWidth,0,Math.PI*2),e(this,t).closePath(),e(this,t).fillStyle="#FFFFFF",e(this,t).fill(),e(this,t).beginPath(),e(this,t).arc(r,s,P,0,Math.PI*2),e(this,t).closePath(),e(this,t).fillStyle="#FFFFFF",e(this,t).fill()};function q(){return Math.ceil(Math.ceil(a.logo.image.side/2*Math.sqrt(2))/2)*2+a.logo.circle.padding+Math.floor(a.logo.circle.strokeWidth/2)}addEventListener("message",async o=>{const{width:h,height:u,images:n,frame:r,color:s,logos:d}=o.data;n.forEach(async c=>{postMessage({id:c.id,url:(await I(h,u,await createImageBitmap(await(await fetch(c.url)).blob(),c.x,c.y,c.width,c.height),r,s,d)).href})})})})();
