var A=s=>{throw TypeError(s)};var p=(s,l,e)=>l.has(s)||A("Cannot "+e);var t=(s,l,e)=>(p(s,l,"read from private field"),e?e.call(s):l.get(s)),b=(s,l,e)=>l.has(s)?A("Cannot add the same private member more than once"):l instanceof WeakSet?l.add(s):l.set(s,e),z=(s,l,e,i)=>(p(s,l,"write to private field"),i?i.call(s,e):l.set(s,e),e),P=(s,l,e)=>(p(s,l,"access private method"),e);var y=(s,l,e,i)=>({set _(m){z(s,l,m,e)},get _(){return t(s,l,i)}});(function(){"use strict";var d,a,w,M,C,S,k;function s(){return!!OffscreenCanvas}var l=(o=>(o.Landscape="landscape",o.Portrait="portrait",o.Square="square",o))(l||{}),e=(o=>(o.AzioneInterna="azione-interna",o.AzioneInteressePubblico="azione-interesse-pubblico",o.AzioneInternazionale="azione-internazionale",o.AzioneNuoveGenerazioni="azione-nuove-generazioni",o.AzioneProfessionale="azione-professionale",o.Cultura="cultura",o.Distretto="distretto",o.Doc="doc",o.Etruria="etruria",o.Galileo="galileo",o.Magnifico="magnifico",o.Montalbano="montalbano",o.Sport="sport",o.Tirreno="tirreno",o))(e||{}),i={canvas:{shortSide:1080,longSide:1620},frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,color:"white",strokeWidth:8}},colors:{[e.AzioneInteressePubblico]:"#d41367",[e.AzioneInterna]:"#d41367",[e.AzioneInternazionale]:"#d41367",[e.AzioneNuoveGenerazioni]:"#d41367",[e.AzioneProfessionale]:"#d41367",[e.Cultura]:"#d41367",[e.Distretto]:"#17458f",[e.Doc]:"#0067c8",[e.Etruria]:"#00adbb",[e.Galileo]:"#f7a81b",[e.Magnifico]:"#009739",[e.Montalbano]:"#901f93",[e.Sport]:"#d41367",[e.Tirreno]:"#ff7600"},hashes:{frames:{[l.Landscape]:"28846",[l.Portrait]:"18461",[l.Square]:"24840"},logos:{[e.AzioneInteressePubblico]:"12481",[e.AzioneInterna]:"07462",[e.AzioneInternazionale]:"62091",[e.AzioneNuoveGenerazioni]:"28340",[e.AzioneProfessionale]:"32990",[e.Cultura]:"57135",[e.Distretto]:"01940",[e.Doc]:"20572",[e.Etruria]:"25935",[e.Galileo]:"28425",[e.Magnifico]:"54002",[e.Montalbano]:"03570",[e.Sport]:"32507",[e.Tirreno]:"48765"}}};const m=T(),v=B();async function E(o,r,n,c,h,g){const f=new x(o,r);f.drawImage(n),f.drawFrame(c,h);for(const u of g)f.drawLogo(u,h??i.colors[e.Distretto]);return new URL(URL.createObjectURL(await f.getBlobAndDestroy()))}class x{constructor(r,n){b(this,M);b(this,d);b(this,a);b(this,w,0);z(this,d,W(r,n));const c=t(this,d).getContext("2d");if(c===null)throw new Error("Canvas 2D rendering context is not supported");z(this,a,c)}drawImage(r){const n=i.frame.border,c=i.frame.border,h=t(this,d).width-i.frame.border*2,g=t(this,d).height-i.frame.border*2;t(this,a).drawImage(r,n,c,h,g)}drawFrame(r,n){for(const c of r.paths)t(this,a).fillStyle=n!==null&&c.customizable?n:c.fill,t(this,a).fill(new Path2D(c.definition))}drawLogo(r,n){const[c,h]=P(this,M,C).call(this);P(this,M,S).call(this,c,h,n);const[g,f]=P(this,M,k).call(this,c,h);t(this,a).drawImage(r,g,f,i.logo.image.side,i.logo.image.side),++y(this,w)._}async getBlobAndDestroy(){const r=t(this,d);if(s()&&r instanceof OffscreenCanvas)return r.convertToBlob();if(r instanceof HTMLCanvasElement)return new Promise((n,c)=>{r.toBlob(h=>{if(h===null){c();return}r.remove(),n(h)})});throw new Error}}d=new WeakMap,a=new WeakMap,w=new WeakMap,M=new WeakSet,C=function(){const r=-Math.PI/4-Math.PI/2*t(this,w);return[Math.cos,Math.sin].map(n=>Math.sign(n(r)))},S=function(r,n,c){const[h,g]=[t(this,d).width/2+r*(t(this,d).width/2-i.logo.circle.margin-Math.floor(i.logo.circle.strokeWidth/2)-m),t(this,d).height/2-n*(t(this,d).height/2-i.logo.circle.margin-Math.floor(i.logo.circle.strokeWidth/2)-m)],f=Math.PI/64,u=Math.PI*3/4;t(this,a).beginPath(),t(this,a).ellipse(h,g,m+i.logo.circle.strokeWidth,m+i.logo.circle.strokeWidth,t(this,w)*Math.PI/2,u+f,u+Math.PI-f),t(this,a).closePath(),t(this,a).fillStyle=c,t(this,a).fill();const I=Math.PI/16;t(this,a).beginPath(),t(this,a).moveTo(h,g),t(this,a).arc(h,g,m+i.logo.circle.strokeWidth+4,t(this,w)*Math.PI/2+Math.PI/4-I/2,t(this,w)*Math.PI/2+Math.PI/4+I/2),t(this,a).closePath(),t(this,a).fillStyle=i.logo.circle.color,t(this,a).fill(),t(this,a).beginPath(),t(this,a).arc(h,g,m,0,Math.PI*2),t(this,a).closePath(),t(this,a).fillStyle=i.logo.circle.color,t(this,a).fill()},k=function(r,n){return[t(this,d).width/2+r*(t(this,d).width/2-v-(r>0?i.logo.image.side:0)),t(this,d).height/2-n*(t(this,d).height/2-v-(n<0?i.logo.image.side:0))]};function W(o,r){try{return new OffscreenCanvas(o,r)}catch{const n=document.createElement("canvas");return n.width=o,n.height=r,n}}function T(){return Math.ceil(Math.ceil(i.logo.image.side/2*Math.sqrt(2))/2)*2+i.logo.circle.padding+Math.floor(i.logo.circle.strokeWidth/2)}function B(){return i.logo.circle.margin+Math.floor(i.logo.circle.strokeWidth/2)+m-i.logo.image.side/2}addEventListener("message",async o=>{const{width:r,height:n,images:c,frame:h,color:g,logos:f}=o.data;c.forEach(async u=>{postMessage({id:u.id,url:(await E(r,n,await createImageBitmap(await(await fetch(u.url)).blob(),u.x,u.y,u.width,u.height),h,g,f)).href})})})})();
