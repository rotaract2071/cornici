var T=d=>{throw TypeError(d)};var P=(d,t,r)=>t.has(d)||T("Cannot "+r);var e=(d,t,r)=>(P(d,t,"read from private field"),r?r.call(d):t.get(d)),z=(d,t,r)=>t.has(d)?T("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(d):t.set(d,r),b=(d,t,r,v)=>(P(d,t,"write to private field"),v?v.call(d,r):t.set(d,r),r),w=(d,t,r)=>(P(d,t,"access private method"),r);var y=(d,t,r,v)=>({set _(p){b(d,t,p,r)},get _(){return e(d,t,v)}});(function(){"use strict";var f,n,m,g,F,M,A;var d=(a=>(a.Landscape="landscape",a.Portrait="portrait",a.Square="square",a))(d||{}),t=(a=>(a.AzioneInteressePubblico="azione-interesse-pubblico",a.AzioneInterna="azione-interna",a.AzioneInternazionale="azione-internazionale",a.AzioneNuoveGenerazioni="azione-nuove-generazioni",a.AzioneProfessionale="azione-professionale",a.Cultura="cultura",a.Distretto="distretto",a.Doc="doc",a.Etruria="etruria",a.FondazioneRotary="fondazione-rotary",a.Galileo="galileo",a.Magnifico="magnifico",a.Montalbano="montalbano",a.Sport="sport",a.Tirreno="tirreno",a))(t||{}),r={frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,strokeWidth:8}},colors:{[t.AzioneInteressePubblico]:"#d41367",[t.AzioneInterna]:"#d41367",[t.AzioneInternazionale]:"#d41367",[t.AzioneNuoveGenerazioni]:"#d41367",[t.AzioneProfessionale]:"#d41367",[t.Cultura]:"#d41367",[t.Distretto]:"#17458f",[t.Doc]:"#0067c8",[t.Etruria]:"#00adbb",[t.FondazioneRotary]:"#d41367",[t.Galileo]:"#f7a81b",[t.Magnifico]:"#009739",[t.Montalbano]:"#901f93",[t.Sport]:"#d41367",[t.Tirreno]:"#ff7600"},hashes:{frames:{[d.Landscape]:"28846",[d.Portrait]:"18461",[d.Square]:"24840"},logos:{[t.AzioneInteressePubblico]:"12481",[t.AzioneInterna]:"07462",[t.AzioneInternazionale]:"62091",[t.AzioneNuoveGenerazioni]:"28340",[t.AzioneProfessionale]:"32990",[t.Cultura]:"57135",[t.Distretto]:"01940",[t.Doc]:"20572",[t.Etruria]:"25935",[t.FondazioneRotary]:"41211",[t.Galileo]:"28425",[t.Magnifico]:"54002",[t.Montalbano]:"03570",[t.Sport]:"32507",[t.Tirreno]:"48765"}}};function v(){return typeof OffscreenCanvas<"u"}function p(a,c){if(v())return new OffscreenCanvas(a,c);const u=document.createElement("canvas");return u.width=a,u.height=c,u}const C=q();async function I(a,c,u,i,o,l){const h=new x(a,c);h.drawImage(u),h.drawFrame(i,o);for(const s of l)h.drawLogo(s,o??r.colors[t.Distretto]);return new URL(URL.createObjectURL(await h.getBlobAndDestroy()))}class x{constructor(c,u){z(this,g);z(this,f);z(this,n);z(this,m,0);b(this,f,p(c,u));const i=e(this,f).getContext("2d");if(!i)throw new Error("Canvas 2D rendering context not supported");b(this,n,i)}drawImage(c){const i=r.frame.border+20,o=r.frame.border+20,l=e(this,f).width-(r.frame.border+20)*2,h=e(this,f).height-(r.frame.border+20)*2,s=Math.min(l,h)*.1;e(this,n).beginPath(),e(this,n).moveTo(i+s,o),e(this,n).lineTo(i+l-s,o),e(this,n).quadraticCurveTo(i+l,o,i+l,o+s),e(this,n).lineTo(i+l,o+h-s),e(this,n).quadraticCurveTo(i+l,o+h,i+l-s,o+h),e(this,n).lineTo(i+s,o+h),e(this,n).quadraticCurveTo(i,o+h,i,o+h-s),e(this,n).lineTo(i,o+s),e(this,n).quadraticCurveTo(i,o,i+s,o),e(this,n).closePath(),e(this,n).fillStyle="#FFFFFF",e(this,n).fill(),e(this,n).save(),e(this,n).beginPath(),e(this,n).moveTo(i+s,o),e(this,n).lineTo(i+l-s,o),e(this,n).quadraticCurveTo(i+l,o,i+l,o+s),e(this,n).lineTo(i+l,o+h-s),e(this,n).quadraticCurveTo(i+l,o+h,i+l-s,o+h),e(this,n).lineTo(i+s,o+h),e(this,n).quadraticCurveTo(i,o+h,i,o+h-s),e(this,n).lineTo(i,o+s),e(this,n).quadraticCurveTo(i,o,i+s,o),e(this,n).closePath(),e(this,n).clip(),e(this,n).drawImage(c,i,o,l,h),e(this,n).restore()}drawFrame(c,u){for(const i of c.paths)e(this,n).fillStyle=u!==null&&i.customizable?u:i.fill,e(this,n).fill(new Path2D(i.definition))}drawLogo(c,u){const[i,o]=w(this,g,F).call(this),[l,h]=w(this,g,M).call(this,i,o);w(this,g,A).call(this,l,h,u),e(this,n).drawImage(c,l,h,r.logo.image.side,r.logo.image.side),y(this,m)._++}async getBlobAndDestroy(){const c=e(this,f);if(v()&&c instanceof OffscreenCanvas)return c.convertToBlob();if(c instanceof HTMLCanvasElement)return new Promise((u,i)=>{c.toBlob(o=>{if(!o){i(new Error("Canvas.toBlob returned null"));return}c.remove(),u(o)})});throw new Error("Unsupported canvas type")}}f=new WeakMap,n=new WeakMap,m=new WeakMap,g=new WeakSet,F=function(){switch(e(this,m)){case 0:return[-1,1];case 1:return[1,-1];default:const c=-Math.PI/4-Math.PI/2*e(this,m);return[Math.cos,Math.sin].map(u=>Math.sign(u(c)))}},M=function(c,u){const i=r.frame.border+r.logo.circle.margin,o=r.logo.image.side,l=c<0?i:e(this,f).width-i-o,h=u>0?i:e(this,f).height-i-o;return[l,h]},A=function(c,u,i){const o=c+r.logo.image.side/2,l=u+r.logo.image.side/2;e(this,n).beginPath(),e(this,n).arc(o,l,C+r.logo.circle.strokeWidth,0,Math.PI*2),e(this,n).closePath(),e(this,n).fillStyle="#FFFFFF",e(this,n).fill(),e(this,n).beginPath(),e(this,n).arc(o,l,C,0,Math.PI*2),e(this,n).closePath(),e(this,n).fillStyle="#FFFFFF",e(this,n).fill()};function q(){return Math.ceil(Math.ceil(r.logo.image.side/2*Math.sqrt(2))/2)*2+r.logo.circle.padding+Math.floor(r.logo.circle.strokeWidth/2)}addEventListener("message",async a=>{const{width:c,height:u,images:i,frame:o,color:l,logos:h}=a.data;i.forEach(async s=>{postMessage({id:s.id,url:(await I(c,u,await createImageBitmap(await(await fetch(s.url)).blob(),s.x,s.y,s.width,s.height),o,l,h)).href})})})})();
