var C=l=>{throw TypeError(l)};var F=(l,i,o)=>i.has(l)||C("Cannot "+o);var e=(l,i,o)=>(F(l,i,"read from private field"),o?o.call(l):i.get(l)),b=(l,i,o)=>i.has(l)?C("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(l):i.set(l,o),m=(l,i,o,v)=>(F(l,i,"write to private field"),v?v.call(l,o):i.set(l,o),o),w=(l,i,o)=>(F(l,i,"access private method"),o);var y=(l,i,o,v)=>({set _(p){m(l,i,p,o)},get _(){return e(l,i,v)}});(function(){"use strict";var f,t,z,g,T,M,A;var l=(a=>(a.Landscape="landscape",a.Portrait="portrait",a.Square="square",a))(l||{}),i=(a=>(a.AzioneInteressePubblico="azione-interesse-pubblico",a.AzioneInterna="azione-interna",a.AzioneInternazionale="azione-internazionale",a.AzioneNuoveGenerazioni="azione-nuove-generazioni",a.AzioneProfessionale="azione-professionale",a.Cultura="cultura",a.Distretto="distretto",a.Doc="doc",a.Etruria="etruria",a.FondazioneRotary="fondazione-rotary",a.Galileo="galileo",a.Magnifico="magnifico",a.Montalbano="montalbano",a.Sport="sport",a.Tirreno="tirreno",a))(i||{}),o={frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,strokeWidth:8}},colors:{[i.AzioneInteressePubblico]:"#d41367",[i.AzioneInterna]:"#d41367",[i.AzioneInternazionale]:"#d41367",[i.AzioneNuoveGenerazioni]:"#d41367",[i.AzioneProfessionale]:"#d41367",[i.Cultura]:"#d41367",[i.Distretto]:"#17458f",[i.Doc]:"#0067c8",[i.Etruria]:"#00adbb",[i.FondazioneRotary]:"#d41367",[i.Galileo]:"#f7a81b",[i.Magnifico]:"#009739",[i.Montalbano]:"#901f93",[i.Sport]:"#d41367",[i.Tirreno]:"#ff7600"},hashes:{frames:{[l.Landscape]:"28846",[l.Portrait]:"18461",[l.Square]:"24840"},logos:{[i.AzioneInteressePubblico]:"12481",[i.AzioneInterna]:"07462",[i.AzioneInternazionale]:"62091",[i.AzioneNuoveGenerazioni]:"28340",[i.AzioneProfessionale]:"32990",[i.Cultura]:"57135",[i.Distretto]:"01940",[i.Doc]:"20572",[i.Etruria]:"25935",[i.FondazioneRotary]:"41211",[i.Galileo]:"28425",[i.Magnifico]:"54002",[i.Montalbano]:"03570",[i.Sport]:"32507",[i.Tirreno]:"48765"}}};function v(){return typeof OffscreenCanvas<"u"}function p(a,c){if(v())return new OffscreenCanvas(a,c);const u=document.createElement("canvas");return u.width=a,u.height=c,u}const P=q();async function I(a,c,u,n,r,h){const d=new x(a,c);d.drawImage(u),d.drawFrame(n,r);for(const s of h)d.drawLogo(s,r??o.colors[i.Distretto]);return new URL(URL.createObjectURL(await d.getBlobAndDestroy()))}class x{constructor(c,u){b(this,g);b(this,f);b(this,t);b(this,z,0);m(this,f,p(c,u));const n=e(this,f).getContext("2d");if(!n)throw new Error("Canvas 2D rendering context not supported");m(this,t,n)}drawImage(c){const n=o.frame.border+20,r=o.frame.border+20,h=e(this,f).width-(o.frame.border+20)*2,d=e(this,f).height-(o.frame.border+20)*2,s=30;e(this,t).save(),e(this,t).fillStyle="#FFFFFF",e(this,t).fillRect(0,0,e(this,f).width,e(this,f).height),e(this,t).restore(),e(this,t).save(),e(this,t).beginPath(),e(this,t).moveTo(n+s,r),e(this,t).lineTo(n+h-s,r),e(this,t).quadraticCurveTo(n+h,r,n+h,r+s),e(this,t).lineTo(n+h,r+d-s),e(this,t).quadraticCurveTo(n+h,r+d,n+h-s,r+d),e(this,t).lineTo(n+s,r+d),e(this,t).quadraticCurveTo(n,r+d,n,r+d-s),e(this,t).lineTo(n,r+s),e(this,t).quadraticCurveTo(n,r,n+s,r),e(this,t).closePath(),e(this,t).fillStyle="#FFFFFF",e(this,t).fill(),e(this,t).restore(),e(this,t).save(),e(this,t).beginPath(),e(this,t).moveTo(n+s,r),e(this,t).lineTo(n+h-s,r),e(this,t).quadraticCurveTo(n+h,r,n+h,r+s),e(this,t).lineTo(n+h,r+d-s),e(this,t).quadraticCurveTo(n+h,r+d,n+h-s,r+d),e(this,t).lineTo(n+s,r+d),e(this,t).quadraticCurveTo(n,r+d,n,r+d-s),e(this,t).lineTo(n,r+s),e(this,t).quadraticCurveTo(n,r,n+s,r),e(this,t).closePath(),e(this,t).clip(),e(this,t).drawImage(c,n,r,h,d),e(this,t).restore()}drawFrame(c,u){for(const n of c.paths)e(this,t).fillStyle=u!==null&&n.customizable?u:n.fill,e(this,t).fill(new Path2D(n.definition))}drawLogo(c,u){const[n,r]=w(this,g,T).call(this),[h,d]=w(this,g,M).call(this,n,r);w(this,g,A).call(this,h,d,u),e(this,t).drawImage(c,h,d,o.logo.image.side,o.logo.image.side),y(this,z)._++}async getBlobAndDestroy(){const c=e(this,f);if(v()&&c instanceof OffscreenCanvas)return c.convertToBlob();if(c instanceof HTMLCanvasElement)return new Promise((u,n)=>{c.toBlob(r=>{if(!r){n(new Error("Canvas.toBlob returned null"));return}c.remove(),u(r)})});throw new Error("Unsupported canvas type")}}f=new WeakMap,t=new WeakMap,z=new WeakMap,g=new WeakSet,T=function(){switch(e(this,z)){case 0:return[-1,1];case 1:return[1,-1];default:const c=-Math.PI/4-Math.PI/2*e(this,z);return[Math.cos,Math.sin].map(u=>Math.sign(u(c)))}},M=function(c,u){const n=o.frame.border+o.logo.circle.margin,r=o.logo.image.side,h=c<0?n:e(this,f).width-n-r,d=u>0?n:e(this,f).height-n-r;return[h,d]},A=function(c,u,n){const r=c+o.logo.image.side/2,h=u+o.logo.image.side/2;e(this,t).beginPath(),e(this,t).arc(r,h,P+o.logo.circle.strokeWidth,0,Math.PI*2),e(this,t).closePath(),e(this,t).fillStyle="#FFFFFF",e(this,t).fill(),e(this,t).beginPath(),e(this,t).arc(r,h,P,0,Math.PI*2),e(this,t).closePath(),e(this,t).fillStyle="#FFFFFF",e(this,t).fill()};function q(){return Math.ceil(Math.ceil(o.logo.image.side/2*Math.sqrt(2))/2)*2+o.logo.circle.padding+Math.floor(o.logo.circle.strokeWidth/2)}addEventListener("message",async a=>{const{width:c,height:u,images:n,frame:r,color:h,logos:d}=a.data;n.forEach(async s=>{postMessage({id:s.id,url:(await I(c,u,await createImageBitmap(await(await fetch(s.url)).blob(),s.x,s.y,s.width,s.height),r,h,d)).href})})})})();
