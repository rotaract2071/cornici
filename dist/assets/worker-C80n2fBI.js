var F=h=>{throw TypeError(h)};var y=(h,e,n)=>e.has(h)||F("Cannot "+n);var t=(h,e,n)=>(y(h,e,"read from private field"),n?n.call(h):e.get(h)),z=(h,e,n)=>e.has(h)?F("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(h):e.set(h,n),b=(h,e,n,v)=>(y(h,e,"write to private field"),v?v.call(h,n):e.set(h,n),n),w=(h,e,n)=>(y(h,e,"access private method"),n);var P=(h,e,n,v)=>({set _(p){b(h,e,p,n)},get _(){return t(h,e,v)}});(function(){"use strict";var f,i,m,g,T,M,A;var h=(o=>(o.Landscape="landscape",o.Portrait="portrait",o.Square="square",o))(h||{}),e=(o=>(o.AzioneInteressePubblico="azione-interesse-pubblico",o.AzioneInterna="azione-interna",o.AzioneInternazionale="azione-internazionale",o.AzioneNuoveGenerazioni="azione-nuove-generazioni",o.AzioneProfessionale="azione-professionale",o.Cultura="cultura",o.DisastriCalamita="disastri-calamita",o.Distretto="distretto",o.Doc="doc",o.Etruria="etruria",o.FondazioneRotary="fondazione-rotary",o.Galileo="galileo",o.Magnifico="magnifico",o.Montalbano="montalbano",o.Sport="sport",o.Tirreno="tirreno",o.Rotary="rotary",o))(e||{}),n={frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,strokeWidth:8}},colors:{[e.AzioneInteressePubblico]:"#d41367",[e.AzioneInterna]:"#d41367",[e.AzioneInternazionale]:"#d41367",[e.AzioneNuoveGenerazioni]:"#d41367",[e.AzioneProfessionale]:"#d41367",[e.Cultura]:"#d41367",[e.DisastriCalamita]:"#d41367",[e.Distretto]:"#17458f",[e.Doc]:"#0067c8",[e.Etruria]:"#00adbb",[e.FondazioneRotary]:"#d41367",[e.Galileo]:"#f7a81b",[e.Magnifico]:"#009739",[e.Montalbano]:"#901f93",[e.Sport]:"#d41367",[e.Tirreno]:"#ff7600",[e.Rotary]:"#d41367"},hashes:{frames:{[h.Landscape]:"28846",[h.Portrait]:"18461",[h.Square]:"24840"},logos:{[e.AzioneInteressePubblico]:"12481",[e.AzioneInterna]:"07462",[e.AzioneInternazionale]:"62091",[e.AzioneNuoveGenerazioni]:"28340",[e.AzioneProfessionale]:"32990",[e.Cultura]:"57135",[e.DisastriCalamita]:"60123",[e.Distretto]:"01940",[e.Doc]:"20572",[e.Etruria]:"25935",[e.FondazioneRotary]:"41211",[e.Galileo]:"28425",[e.Magnifico]:"54002",[e.Montalbano]:"03570",[e.Sport]:"32507",[e.Tirreno]:"48765",[e.Rotary]:"17409"}}};function v(){return typeof OffscreenCanvas<"u"}function p(o,l){if(v())return new OffscreenCanvas(o,l);const u=document.createElement("canvas");return u.width=o,u.height=l,u}const C=q();async function I(o,l,u,a,r,s){const d=new x(o,l);d.drawImage(u),d.drawFrame(a,r);const c=s.length===1?[s[0],s[0]]:s;for(const R of c)d.drawLogo(R,r??n.colors[e.Distretto]);return new URL(URL.createObjectURL(await d.getBlobAndDestroy()))}class x{constructor(l,u){z(this,g);z(this,f);z(this,i);z(this,m,0);b(this,f,p(l,u));const a=t(this,f).getContext("2d");if(!a)throw new Error("Canvas 2D rendering context not supported");b(this,i,a)}drawImage(l){const a=n.frame.border+20,r=n.frame.border+20,s=t(this,f).width-(n.frame.border+20)*2,d=t(this,f).height-(n.frame.border+20)*2,c=30;t(this,i).save(),t(this,i).fillStyle="#FFFFFF",t(this,i).fillRect(0,0,t(this,f).width,t(this,f).height),t(this,i).restore(),t(this,i).save(),t(this,i).beginPath(),t(this,i).moveTo(a+c,r),t(this,i).lineTo(a+s-c,r),t(this,i).quadraticCurveTo(a+s,r,a+s,r+c),t(this,i).lineTo(a+s,r+d-c),t(this,i).quadraticCurveTo(a+s,r+d,a+s-c,r+d),t(this,i).lineTo(a+c,r+d),t(this,i).quadraticCurveTo(a,r+d,a,r+d-c),t(this,i).lineTo(a,r+c),t(this,i).quadraticCurveTo(a,r,a+c,r),t(this,i).closePath(),t(this,i).fillStyle="#FFFFFF",t(this,i).fill(),t(this,i).restore(),t(this,i).save(),t(this,i).beginPath(),t(this,i).moveTo(a+c,r),t(this,i).lineTo(a+s-c,r),t(this,i).quadraticCurveTo(a+s,r,a+s,r+c),t(this,i).lineTo(a+s,r+d-c),t(this,i).quadraticCurveTo(a+s,r+d,a+s-c,r+d),t(this,i).lineTo(a+c,r+d),t(this,i).quadraticCurveTo(a,r+d,a,r+d-c),t(this,i).lineTo(a,r+c),t(this,i).quadraticCurveTo(a,r,a+c,r),t(this,i).closePath(),t(this,i).clip(),t(this,i).drawImage(l,a,r,s,d),t(this,i).restore()}drawFrame(l,u){for(const a of l.paths)t(this,i).fillStyle=u!==null&&a.customizable?u:a.fill,t(this,i).fill(new Path2D(a.definition))}drawLogo(l,u){const[a,r]=w(this,g,T).call(this),[s,d]=w(this,g,M).call(this,a,r);w(this,g,A).call(this,s,d,u),t(this,i).drawImage(l,s,d,n.logo.image.side,n.logo.image.side),P(this,m)._++}async getBlobAndDestroy(){const l=t(this,f);if(v()&&l instanceof OffscreenCanvas)return l.convertToBlob();if(l instanceof HTMLCanvasElement)return new Promise((u,a)=>{l.toBlob(r=>{if(!r){a(new Error("Canvas.toBlob returned null"));return}l.remove(),u(r)})});throw new Error("Unsupported canvas type")}}f=new WeakMap,i=new WeakMap,m=new WeakMap,g=new WeakSet,T=function(){switch(t(this,m)){case 0:return[-1,1];case 1:return[1,-1];default:const l=-Math.PI/4-Math.PI/2*t(this,m);return[Math.cos,Math.sin].map(u=>Math.sign(u(l)))}},M=function(l,u){const a=n.frame.border+n.logo.circle.margin,r=n.logo.image.side,s=l<0?a:t(this,f).width-a-r,d=u>0?a:t(this,f).height-a-r;return[s,d]},A=function(l,u,a){const r=l+n.logo.image.side/2,s=u+n.logo.image.side/2;t(this,i).beginPath(),t(this,i).arc(r,s,C+n.logo.circle.strokeWidth,0,Math.PI*2),t(this,i).closePath(),t(this,i).fillStyle="#FFFFFF",t(this,i).fill(),t(this,i).beginPath(),t(this,i).arc(r,s,C,0,Math.PI*2),t(this,i).closePath(),t(this,i).fillStyle="#FFFFFF",t(this,i).fill()};function q(){return Math.ceil(Math.ceil(n.logo.image.side/2*Math.sqrt(2))/2)*2+n.logo.circle.padding+Math.floor(n.logo.circle.strokeWidth/2)}addEventListener("message",async o=>{const{width:l,height:u,images:a,frame:r,color:s,logos:d}=o.data;a.forEach(async c=>{postMessage({id:c.id,url:(await I(l,u,await createImageBitmap(await(await fetch(c.url)).blob(),c.x,c.y,c.width,c.height),r,s,d)).href})})})})();
