var T=l=>{throw TypeError(l)};var P=(l,t,o)=>t.has(l)||T("Cannot "+o);var e=(l,t,o)=>(P(l,t,"read from private field"),o?o.call(l):t.get(l)),b=(l,t,o)=>t.has(l)?T("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(l):t.set(l,o),m=(l,t,o,v)=>(P(l,t,"write to private field"),v?v.call(l,o):t.set(l,o),o),w=(l,t,o)=>(P(l,t,"access private method"),o);var y=(l,t,o,v)=>({set _(p){m(l,t,p,o)},get _(){return e(l,t,v)}});(function(){"use strict";var f,n,z,g,F,M,A;var l=(a=>(a.Landscape="landscape",a.Portrait="portrait",a.Square="square",a))(l||{}),t=(a=>(a.AzioneInteressePubblico="azione-interesse-pubblico",a.AzioneInterna="azione-interna",a.AzioneInternazionale="azione-internazionale",a.AzioneNuoveGenerazioni="azione-nuove-generazioni",a.AzioneProfessionale="azione-professionale",a.Cultura="cultura",a.Distretto="distretto",a.Doc="doc",a.Etruria="etruria",a.FondazioneRotary="fondazione-rotary",a.Galileo="galileo",a.Magnifico="magnifico",a.Montalbano="montalbano",a.Sport="sport",a.Tirreno="tirreno",a))(t||{}),o={frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,strokeWidth:8}},colors:{[t.AzioneInteressePubblico]:"#d41367",[t.AzioneInterna]:"#d41367",[t.AzioneInternazionale]:"#d41367",[t.AzioneNuoveGenerazioni]:"#d41367",[t.AzioneProfessionale]:"#d41367",[t.Cultura]:"#d41367",[t.Distretto]:"#17458f",[t.Doc]:"#0067c8",[t.Etruria]:"#00adbb",[t.FondazioneRotary]:"#d41367",[t.Galileo]:"#f7a81b",[t.Magnifico]:"#009739",[t.Montalbano]:"#901f93",[t.Sport]:"#d41367",[t.Tirreno]:"#ff7600"},hashes:{frames:{[l.Landscape]:"28846",[l.Portrait]:"18461",[l.Square]:"24840"},logos:{[t.AzioneInteressePubblico]:"12481",[t.AzioneInterna]:"07462",[t.AzioneInternazionale]:"62091",[t.AzioneNuoveGenerazioni]:"28340",[t.AzioneProfessionale]:"32990",[t.Cultura]:"57135",[t.Distretto]:"01940",[t.Doc]:"20572",[t.Etruria]:"25935",[t.FondazioneRotary]:"41211",[t.Galileo]:"28425",[t.Magnifico]:"54002",[t.Montalbano]:"03570",[t.Sport]:"32507",[t.Tirreno]:"48765"}}};function v(){return typeof OffscreenCanvas<"u"}function p(a,c){if(v())return new OffscreenCanvas(a,c);const u=document.createElement("canvas");return u.width=a,u.height=c,u}const C=q();async function I(a,c,u,i,r,h){const d=new x(a,c);d.drawImage(u),d.drawFrame(i,r);for(const s of h)d.drawLogo(s,r??o.colors[t.Distretto]);return new URL(URL.createObjectURL(await d.getBlobAndDestroy()))}class x{constructor(c,u){b(this,g);b(this,f);b(this,n);b(this,z,0);m(this,f,p(c,u));const i=e(this,f).getContext("2d");if(!i)throw new Error("Canvas 2D rendering context not supported");m(this,n,i)}drawImage(c){const i=o.frame.border+20,r=o.frame.border+20,h=e(this,f).width-(o.frame.border+20)*2,d=e(this,f).height-(o.frame.border+20)*2,s=30;e(this,n).save(),e(this,n).beginPath(),e(this,n).moveTo(i+s,r),e(this,n).lineTo(i+h-s,r),e(this,n).quadraticCurveTo(i+h,r,i+h,r+s),e(this,n).lineTo(i+h,r+d-s),e(this,n).quadraticCurveTo(i+h,r+d,i+h-s,r+d),e(this,n).lineTo(i+s,r+d),e(this,n).quadraticCurveTo(i,r+d,i,r+d-s),e(this,n).lineTo(i,r+s),e(this,n).quadraticCurveTo(i,r,i+s,r),e(this,n).closePath(),e(this,n).fillStyle="#FFFFFF",e(this,n).fill(),e(this,n).restore(),e(this,n).save(),e(this,n).beginPath(),e(this,n).moveTo(i+s,r),e(this,n).lineTo(i+h-s,r),e(this,n).quadraticCurveTo(i+h,r,i+h,r+s),e(this,n).lineTo(i+h,r+d-s),e(this,n).quadraticCurveTo(i+h,r+d,i+h-s,r+d),e(this,n).lineTo(i+s,r+d),e(this,n).quadraticCurveTo(i,r+d,i,r+d-s),e(this,n).lineTo(i,r+s),e(this,n).quadraticCurveTo(i,r,i+s,r),e(this,n).closePath(),e(this,n).clip(),e(this,n).drawImage(c,i,r,h,d),e(this,n).restore()}drawFrame(c,u){for(const i of c.paths)e(this,n).fillStyle=u!==null&&i.customizable?u:i.fill,e(this,n).fill(new Path2D(i.definition))}drawLogo(c,u){const[i,r]=w(this,g,F).call(this),[h,d]=w(this,g,M).call(this,i,r);w(this,g,A).call(this,h,d,u),e(this,n).drawImage(c,h,d,o.logo.image.side,o.logo.image.side),y(this,z)._++}async getBlobAndDestroy(){const c=e(this,f);if(v()&&c instanceof OffscreenCanvas)return c.convertToBlob();if(c instanceof HTMLCanvasElement)return new Promise((u,i)=>{c.toBlob(r=>{if(!r){i(new Error("Canvas.toBlob returned null"));return}c.remove(),u(r)})});throw new Error("Unsupported canvas type")}}f=new WeakMap,n=new WeakMap,z=new WeakMap,g=new WeakSet,F=function(){switch(e(this,z)){case 0:return[-1,1];case 1:return[1,-1];default:const c=-Math.PI/4-Math.PI/2*e(this,z);return[Math.cos,Math.sin].map(u=>Math.sign(u(c)))}},M=function(c,u){const i=o.frame.border+o.logo.circle.margin,r=o.logo.image.side,h=c<0?i:e(this,f).width-i-r,d=u>0?i:e(this,f).height-i-r;return[h,d]},A=function(c,u,i){const r=c+o.logo.image.side/2,h=u+o.logo.image.side/2;e(this,n).beginPath(),e(this,n).arc(r,h,C+o.logo.circle.strokeWidth,0,Math.PI*2),e(this,n).closePath(),e(this,n).fillStyle="#FFFFFF",e(this,n).fill(),e(this,n).beginPath(),e(this,n).arc(r,h,C,0,Math.PI*2),e(this,n).closePath(),e(this,n).fillStyle="#FFFFFF",e(this,n).fill()};function q(){return Math.ceil(Math.ceil(o.logo.image.side/2*Math.sqrt(2))/2)*2+o.logo.circle.padding+Math.floor(o.logo.circle.strokeWidth/2)}addEventListener("message",async a=>{const{width:c,height:u,images:i,frame:r,color:h,logos:d}=a.data;i.forEach(async s=>{postMessage({id:s.id,url:(await I(c,u,await createImageBitmap(await(await fetch(s.url)).blob(),s.x,s.y,s.width,s.height),r,h,d)).href})})})})();
