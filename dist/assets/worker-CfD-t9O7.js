var C=c=>{throw TypeError(c)};var P=(c,e,r)=>e.has(c)||C("Cannot "+r);var t=(c,e,r)=>(P(c,e,"read from private field"),r?r.call(c):e.get(c)),b=(c,e,r)=>e.has(c)?C("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(c):e.set(c,r),m=(c,e,r,z)=>(P(c,e,"write to private field"),z?z.call(c,r):e.set(c,r),r),w=(c,e,r)=>(P(c,e,"access private method"),r);var F=(c,e,r,z)=>({set _(p){m(c,e,p,r)},get _(){return t(c,e,z)}});(function(){"use strict";var f,n,v,g,M,A,I;var c=(a=>(a.Landscape="landscape",a.Portrait="portrait",a.Square="square",a))(c||{}),e=(a=>(a.AzioneInteressePubblico="azione-interesse-pubblico",a.AzioneInterna="azione-interna",a.AzioneInternazionale="azione-internazionale",a.AzioneNuoveGenerazioni="azione-nuove-generazioni",a.AzioneProfessionale="azione-professionale",a.Cultura="cultura",a.Distretto="distretto",a.Doc="doc",a.Etruria="etruria",a.FondazioneRotary="fondazione-rotary",a.Galileo="galileo",a.Magnifico="magnifico",a.Montalbano="montalbano",a.Sport="sport",a.Tirreno="tirreno",a))(e||{}),r={frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,strokeWidth:8}},colors:{[e.AzioneInteressePubblico]:"#d41367",[e.AzioneInterna]:"#d41367",[e.AzioneInternazionale]:"#d41367",[e.AzioneNuoveGenerazioni]:"#d41367",[e.AzioneProfessionale]:"#d41367",[e.Cultura]:"#d41367",[e.Distretto]:"#17458f",[e.Doc]:"#0067c8",[e.Etruria]:"#00adbb",[e.FondazioneRotary]:"#d41367",[e.Galileo]:"#f7a81b",[e.Magnifico]:"#009739",[e.Montalbano]:"#901f93",[e.Sport]:"#d41367",[e.Tirreno]:"#ff7600"},hashes:{frames:{[c.Landscape]:"28846",[c.Portrait]:"18461",[c.Square]:"24840"},logos:{[e.AzioneInteressePubblico]:"12481",[e.AzioneInterna]:"07462",[e.AzioneInternazionale]:"62091",[e.AzioneNuoveGenerazioni]:"28340",[e.AzioneProfessionale]:"32990",[e.Cultura]:"57135",[e.Distretto]:"01940",[e.Doc]:"20572",[e.Etruria]:"25935",[e.FondazioneRotary]:"41211",[e.Galileo]:"28425",[e.Magnifico]:"54002",[e.Montalbano]:"03570",[e.Sport]:"32507",[e.Tirreno]:"48765"}}};function z(){return typeof OffscreenCanvas<"u"}function p(a,s){if(z())return new OffscreenCanvas(a,s);const l=document.createElement("canvas");return l.width=a,l.height=s,l}const y=E();async function T(a,s,l,i,o,d){const h=new x(a,s);h.drawImage(l),h.drawFrame(i,o);for(const u of d)h.drawLogo(u,o??r.colors[e.Distretto]);return new URL(URL.createObjectURL(await h.getBlobAndDestroy()))}class x{constructor(s,l){b(this,g);b(this,f);b(this,n);b(this,v,0);m(this,f,p(s,l));const i=t(this,f).getContext("2d");if(!i)throw new Error("Canvas 2D rendering context not supported");m(this,n,i)}drawImage(s){const i=r.frame.border+20,o=r.frame.border+20,d=t(this,f).width-(r.frame.border+20)*2,h=t(this,f).height-(r.frame.border+20)*2,u=30;t(this,n).beginPath(),t(this,n).moveTo(i+u,o),t(this,n).lineTo(i+d-u,o),t(this,n).quadraticCurveTo(i+d,o,i+d,o+u),t(this,n).lineTo(i+d,o+h-u),t(this,n).quadraticCurveTo(i+d,o+h,i+d-u,o+h),t(this,n).lineTo(i+u,o+h),t(this,n).quadraticCurveTo(i,o+h,i,o+h-u),t(this,n).lineTo(i,o+u),t(this,n).quadraticCurveTo(i,o,i+u,o),t(this,n).closePath(),t(this,n).fillStyle="#FFFFFF",t(this,n).fill(),t(this,n).save(),t(this,n).clip(),t(this,n).drawImage(s,i,o,d,h),t(this,n).restore()}drawFrame(s,l){for(const i of s.paths)t(this,n).fillStyle=l!==null&&i.customizable?l:i.fill,t(this,n).fill(new Path2D(i.definition))}drawLogo(s,l){const[i,o]=w(this,g,M).call(this),[d,h]=w(this,g,A).call(this,i,o);w(this,g,I).call(this,d,h,l),t(this,n).drawImage(s,d,h,r.logo.image.side,r.logo.image.side),F(this,v)._++}async getBlobAndDestroy(){const s=t(this,f);if(z()&&s instanceof OffscreenCanvas)return s.convertToBlob();if(s instanceof HTMLCanvasElement)return new Promise((l,i)=>{s.toBlob(o=>{if(!o){i(new Error("Canvas.toBlob returned null"));return}s.remove(),l(o)})});throw new Error("Unsupported canvas type")}}f=new WeakMap,n=new WeakMap,v=new WeakMap,g=new WeakSet,M=function(){switch(t(this,v)){case 0:return[-1,1];case 1:return[1,-1];default:const s=-Math.PI/4-Math.PI/2*t(this,v);return[Math.cos,Math.sin].map(l=>Math.sign(l(s)))}},A=function(s,l){const i=r.frame.border+r.logo.circle.margin,o=r.logo.image.side,d=s<0?i:t(this,f).width-i-o,h=l>0?i:t(this,f).height-i-o;return[d,h]},I=function(s,l,i){const o=s+r.logo.image.side/2,d=l+r.logo.image.side/2;t(this,n).beginPath(),t(this,n).arc(o,d,y+r.logo.circle.strokeWidth,0,Math.PI*2),t(this,n).closePath(),t(this,n).fillStyle="#FFFFFF",t(this,n).fill(),t(this,n).beginPath(),t(this,n).arc(o,d,y,0,Math.PI*2),t(this,n).closePath(),t(this,n).fillStyle="#FFFFFF",t(this,n).fill()};function E(){return Math.ceil(Math.ceil(r.logo.image.side/2*Math.sqrt(2))/2)*2+r.logo.circle.padding+Math.floor(r.logo.circle.strokeWidth/2)}addEventListener("message",async a=>{const{width:s,height:l,images:i,frame:o,color:d,logos:h}=a.data;i.forEach(async u=>{postMessage({id:u.id,url:(await T(s,l,await createImageBitmap(await(await fetch(u.url)).blob(),u.x,u.y,u.width,u.height),o,d,h)).href})})})})();
