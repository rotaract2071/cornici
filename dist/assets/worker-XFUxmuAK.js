var A=s=>{throw TypeError(s)};var p=(s,l,e)=>l.has(s)||A("Cannot "+e);var t=(s,l,e)=>(p(s,l,"read from private field"),e?e.call(s):l.get(s)),M=(s,l,e)=>l.has(s)?A("Cannot add the same private member more than once"):l instanceof WeakSet?l.add(s):l.set(s,e),b=(s,l,e,i)=>(p(s,l,"write to private field"),i?i.call(s,e):l.set(s,e),e),P=(s,l,e)=>(p(s,l,"access private method"),e);var y=(s,l,e,i)=>({set _(m){b(s,l,m,e)},get _(){return t(s,l,i)}});(function(){"use strict";var d,a,w,z,C,S,k;function s(){return"OffscreenCanvas"in globalThis}var l=(o=>(o.Landscape="landscape",o.Portrait="portrait",o.Square="square",o))(l||{}),e=(o=>(o.AzioneInteressePubblico="azione-interesse-pubblico",o.AzioneInterna="azione-interna",o.AzioneInternazionale="azione-internazionale",o.AzioneNuoveGenerazioni="azione-nuove-generazioni",o.AzioneProfessionale="azione-professionale",o.Cultura="cultura",o.Distretto="distretto",o.Doc="doc",o.Etruria="etruria",o.FondazioneRotary="fondazione-rotary",o.Galileo="galileo",o.Magnifico="magnifico",o.Montalbano="montalbano",o.Sport="sport",o.Tirreno="tirreno",o))(e||{}),i={frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,color:"white",strokeWidth:8}},colors:{[e.AzioneInteressePubblico]:"#d41367",[e.AzioneInterna]:"#d41367",[e.AzioneInternazionale]:"#d41367",[e.AzioneNuoveGenerazioni]:"#d41367",[e.AzioneProfessionale]:"#d41367",[e.Cultura]:"#d41367",[e.Distretto]:"#17458f",[e.Doc]:"#0067c8",[e.Etruria]:"#00adbb",[e.FondazioneRotary]:"#d41367",[e.Galileo]:"#f7a81b",[e.Magnifico]:"#009739",[e.Montalbano]:"#901f93",[e.Sport]:"#d41367",[e.Tirreno]:"#ff7600"},hashes:{frames:{[l.Landscape]:"28846",[l.Portrait]:"18461",[l.Square]:"24840"},logos:{[e.AzioneInteressePubblico]:"12481",[e.AzioneInterna]:"07462",[e.AzioneInternazionale]:"62091",[e.AzioneNuoveGenerazioni]:"28340",[e.AzioneProfessionale]:"32990",[e.Cultura]:"57135",[e.Distretto]:"01940",[e.Doc]:"20572",[e.Etruria]:"25935",[e.FondazioneRotary]:"41211",[e.Galileo]:"28425",[e.Magnifico]:"54002",[e.Montalbano]:"03570",[e.Sport]:"32507",[e.Tirreno]:"48765"}}};const m=T(),I=W();async function E(o,n,r,c,h,g){const f=new x(o,n);f.drawImage(r),f.drawFrame(c,h);for(const u of g)f.drawLogo(u,h??i.colors[e.Distretto]);return new URL(URL.createObjectURL(await f.getBlobAndDestroy()))}class x{constructor(n,r){M(this,z);M(this,d);M(this,a);M(this,w,0);b(this,d,R(n,r));const c=t(this,d).getContext("2d");if(c===null)throw new Error("Canvas 2D rendering context is not supported");b(this,a,c)}drawImage(n){const r=i.frame.border,c=i.frame.border,h=t(this,d).width-i.frame.border*2,g=t(this,d).height-i.frame.border*2;t(this,a).drawImage(n,r,c,h,g)}drawFrame(n,r){for(const c of n.paths)t(this,a).fillStyle=r!==null&&c.customizable?r:c.fill,t(this,a).fill(new Path2D(c.definition))}drawLogo(n,r){const[c,h]=P(this,z,C).call(this);P(this,z,S).call(this,c,h,r);const[g,f]=P(this,z,k).call(this,c,h);t(this,a).drawImage(n,g,f,i.logo.image.side,i.logo.image.side),++y(this,w)._}async getBlobAndDestroy(){const n=t(this,d);if(s()&&n instanceof OffscreenCanvas)return n.convertToBlob();if(n instanceof HTMLCanvasElement)return new Promise((r,c)=>{n.toBlob(h=>{if(h===null){c();return}n.remove(),r(h)})});throw new Error}}d=new WeakMap,a=new WeakMap,w=new WeakMap,z=new WeakSet,C=function(){const n=-Math.PI/4-Math.PI/2*t(this,w);return[Math.cos,Math.sin].map(r=>Math.sign(r(n)))},S=function(n,r,c){const[h,g]=[t(this,d).width/2+n*(t(this,d).width/2-i.logo.circle.margin-Math.floor(i.logo.circle.strokeWidth/2)-m),t(this,d).height/2-r*(t(this,d).height/2-i.logo.circle.margin-Math.floor(i.logo.circle.strokeWidth/2)-m)],f=Math.PI/64,u=Math.PI*3/4;t(this,a).beginPath(),t(this,a).ellipse(h,g,m+i.logo.circle.strokeWidth,m+i.logo.circle.strokeWidth,t(this,w)*Math.PI/2,u+f,u+Math.PI-f),t(this,a).closePath(),t(this,a).fillStyle=c,t(this,a).fill();const v=Math.PI/16;t(this,a).beginPath(),t(this,a).moveTo(h,g),t(this,a).arc(h,g,m+i.logo.circle.strokeWidth+4,t(this,w)*Math.PI/2+Math.PI/4-v/2,t(this,w)*Math.PI/2+Math.PI/4+v/2),t(this,a).closePath(),t(this,a).fillStyle=i.logo.circle.color,t(this,a).fill(),t(this,a).beginPath(),t(this,a).arc(h,g,m,0,Math.PI*2),t(this,a).closePath(),t(this,a).fillStyle=i.logo.circle.color,t(this,a).fill()},k=function(n,r){return[t(this,d).width/2+n*(t(this,d).width/2-I-(n>0?i.logo.image.side:0)),t(this,d).height/2-r*(t(this,d).height/2-I-(r<0?i.logo.image.side:0))]};function R(o,n){if(s())return new OffscreenCanvas(o,n);const r=document.createElement("canvas");return r.width=o,r.height=n,r}function T(){return Math.ceil(Math.ceil(i.logo.image.side/2*Math.sqrt(2))/2)*2+i.logo.circle.padding+Math.floor(i.logo.circle.strokeWidth/2)}function W(){return i.logo.circle.margin+Math.floor(i.logo.circle.strokeWidth/2)+m-i.logo.image.side/2}addEventListener("message",async o=>{const{width:n,height:r,images:c,frame:h,color:g,logos:f}=o.data;c.forEach(async u=>{postMessage({id:u.id,url:(await E(n,r,await createImageBitmap(await(await fetch(u.url)).blob(),u.x,u.y,u.width,u.height),h,g,f)).href})})})})();
