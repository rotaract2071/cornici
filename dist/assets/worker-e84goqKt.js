var A=s=>{throw TypeError(s)};var p=(s,l,t)=>l.has(s)||A("Cannot "+t);var e=(s,l,t)=>(p(s,l,"read from private field"),t?t.call(s):l.get(s)),M=(s,l,t)=>l.has(s)?A("Cannot add the same private member more than once"):l instanceof WeakSet?l.add(s):l.set(s,t),P=(s,l,t,o)=>(p(s,l,"write to private field"),o?o.call(s,t):l.set(s,t),t),b=(s,l,t)=>(p(s,l,"access private method"),t);var y=(s,l,t,o)=>({set _(m){P(s,l,m,t)},get _(){return e(s,l,o)}});(function(){"use strict";var d,a,w,z,C,S,k;function s(){return"OffscreenCanvas"in globalThis}var l=(i=>(i.Landscape="landscape",i.Portrait="portrait",i.Square="square",i))(l||{}),t=(i=>(i.AzioneInteressePubblico="azione-interesse-pubblico",i.AzioneInterna="azione-interna",i.AzioneInternazionale="azione-internazionale",i.AzioneNuoveGenerazioni="azione-nuove-generazioni",i.AzioneProfessionale="azione-professionale",i.Cultura="cultura",i.Distretto="distretto",i.DistrettoPast="distretto-past",i.Doc="doc",i.Etruria="etruria",i.FondazioneRotary="fondazione-rotary",i.Galileo="galileo",i.Magnifico="magnifico",i.Montalbano="montalbano",i.Sport="sport",i.Tirreno="tirreno",i))(t||{}),o={canvas:{shortSide:1080,longSide:1620},frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,color:"white",strokeWidth:8}},colors:{[t.AzioneInteressePubblico]:"#d41367",[t.AzioneInterna]:"#d41367",[t.AzioneInternazionale]:"#d41367",[t.AzioneNuoveGenerazioni]:"#d41367",[t.AzioneProfessionale]:"#d41367",[t.Cultura]:"#d41367",[t.Distretto]:"#17458f",[t.DistrettoPast]:"#d41367",[t.Doc]:"#0067c8",[t.Etruria]:"#00adbb",[t.FondazioneRotary]:"#d41367",[t.Galileo]:"#f7a81b",[t.Magnifico]:"#009739",[t.Montalbano]:"#901f93",[t.Sport]:"#d41367",[t.Tirreno]:"#ff7600"},hashes:{frames:{[l.Landscape]:"28846",[l.Portrait]:"18461",[l.Square]:"24840"},logos:{[t.AzioneInteressePubblico]:"12481",[t.AzioneInterna]:"07462",[t.AzioneInternazionale]:"62091",[t.AzioneNuoveGenerazioni]:"28340",[t.AzioneProfessionale]:"32990",[t.Cultura]:"57135",[t.Distretto]:"01940",[t.DistrettoPast]:"35413",[t.Doc]:"20572",[t.Etruria]:"25935",[t.FondazioneRotary]:"41211",[t.Galileo]:"28425",[t.Magnifico]:"54002",[t.Montalbano]:"03570",[t.Sport]:"32507",[t.Tirreno]:"48765"}}};const m=R(),v=T();async function D(i,r,n,c,h,g){const f=new E(i,r);f.drawImage(n),f.drawFrame(c,h);for(const u of g)f.drawLogo(u,h??o.colors[t.Distretto]);return new URL(URL.createObjectURL(await f.getBlobAndDestroy()))}class E{constructor(r,n){M(this,z);M(this,d);M(this,a);M(this,w,0);P(this,d,x(r,n));const c=e(this,d).getContext("2d");if(c===null)throw new Error("Canvas 2D rendering context is not supported");P(this,a,c)}drawImage(r){const n=o.frame.border,c=o.frame.border,h=e(this,d).width-o.frame.border*2,g=e(this,d).height-o.frame.border*2;e(this,a).drawImage(r,n,c,h,g)}drawFrame(r,n){for(const c of r.paths)e(this,a).fillStyle=n!==null&&c.customizable?n:c.fill,e(this,a).fill(new Path2D(c.definition))}drawLogo(r,n){const[c,h]=b(this,z,C).call(this);b(this,z,S).call(this,c,h,n);const[g,f]=b(this,z,k).call(this,c,h);e(this,a).drawImage(r,g,f,o.logo.image.side,o.logo.image.side),++y(this,w)._}async getBlobAndDestroy(){const r=e(this,d);if(s()&&r instanceof OffscreenCanvas)return r.convertToBlob();if(r instanceof HTMLCanvasElement)return new Promise((n,c)=>{r.toBlob(h=>{if(h===null){c();return}r.remove(),n(h)})});throw new Error}}d=new WeakMap,a=new WeakMap,w=new WeakMap,z=new WeakSet,C=function(){const r=-Math.PI/4-Math.PI/2*e(this,w);return[Math.cos,Math.sin].map(n=>Math.sign(n(r)))},S=function(r,n,c){const[h,g]=[e(this,d).width/2+r*(e(this,d).width/2-o.logo.circle.margin-Math.floor(o.logo.circle.strokeWidth/2)-m),e(this,d).height/2-n*(e(this,d).height/2-o.logo.circle.margin-Math.floor(o.logo.circle.strokeWidth/2)-m)],f=Math.PI/64,u=Math.PI*3/4;e(this,a).beginPath(),e(this,a).ellipse(h,g,m+o.logo.circle.strokeWidth,m+o.logo.circle.strokeWidth,e(this,w)*Math.PI/2,u+f,u+Math.PI-f),e(this,a).closePath(),e(this,a).fillStyle=c,e(this,a).fill();const I=Math.PI/16;e(this,a).beginPath(),e(this,a).moveTo(h,g),e(this,a).arc(h,g,m+o.logo.circle.strokeWidth+4,e(this,w)*Math.PI/2+Math.PI/4-I/2,e(this,w)*Math.PI/2+Math.PI/4+I/2),e(this,a).closePath(),e(this,a).fillStyle=o.logo.circle.color,e(this,a).fill(),e(this,a).beginPath(),e(this,a).arc(h,g,m,0,Math.PI*2),e(this,a).closePath(),e(this,a).fillStyle=o.logo.circle.color,e(this,a).fill()},k=function(r,n){return[e(this,d).width/2+r*(e(this,d).width/2-v-(r>0?o.logo.image.side:0)),e(this,d).height/2-n*(e(this,d).height/2-v-(n<0?o.logo.image.side:0))]};function x(i,r){if(s())return new OffscreenCanvas(i,r);const n=document.createElement("canvas");return n.width=i,n.height=r,n}function R(){return Math.ceil(Math.ceil(o.logo.image.side/2*Math.sqrt(2))/2)*2+o.logo.circle.padding+Math.floor(o.logo.circle.strokeWidth/2)}function T(){return o.logo.circle.margin+Math.floor(o.logo.circle.strokeWidth/2)+m-o.logo.image.side/2}addEventListener("message",async i=>{const{width:r,height:n,images:c,frame:h,color:g,logos:f}=i.data;c.forEach(async u=>{postMessage({id:u.id,url:(await D(r,n,await createImageBitmap(await(await fetch(u.url)).blob(),u.x,u.y,u.width,u.height),h,g,f)).href})})})})();
