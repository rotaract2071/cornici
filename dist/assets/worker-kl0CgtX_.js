var A=r=>{throw TypeError(r)};var y=(r,e,t)=>e.has(r)||A("Cannot "+t);var a=(r,e,t)=>(y(r,e,"read from private field"),t?t.call(r):e.get(r)),b=(r,e,t)=>e.has(r)?A("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),m=(r,e,t,z)=>(y(r,e,"write to private field"),z?z.call(r,t):e.set(r,t),t),p=(r,e,t)=>(y(r,e,"access private method"),t);var I=(r,e,t,z)=>({set _(v){m(r,e,v,t)},get _(){return a(r,e,z)}});(function(){"use strict";var f,c,w,u,P,C,E;var r=(n=>(n.Landscape="landscape",n.Portrait="portrait",n.Square="square",n))(r||{}),e=(n=>(n.AzioneInteressePubblico="azione-interesse-pubblico",n.AzioneInterna="azione-interna",n.AzioneInternazionale="azione-internazionale",n.AzioneNuoveGenerazioni="azione-nuove-generazioni",n.AzioneProfessionale="azione-professionale",n.Cultura="cultura",n.Distretto="distretto",n.Doc="doc",n.Etruria="etruria",n.FondazioneRotary="fondazione-rotary",n.Galileo="galileo",n.Magnifico="magnifico",n.Montalbano="montalbano",n.Sport="sport",n.Tirreno="tirreno",n))(e||{}),t={frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,color:"white",strokeWidth:8}},colors:{[e.AzioneInteressePubblico]:"#d41367",[e.AzioneInterna]:"#d41367",[e.AzioneInternazionale]:"#d41367",[e.AzioneNuoveGenerazioni]:"#d41367",[e.AzioneProfessionale]:"#d41367",[e.Cultura]:"#d41367",[e.Distretto]:"#17458f",[e.Doc]:"#0067c8",[e.Etruria]:"#00adbb",[e.FondazioneRotary]:"#d41367",[e.Galileo]:"#f7a81b",[e.Magnifico]:"#009739",[e.Montalbano]:"#901f93",[e.Sport]:"#d41367",[e.Tirreno]:"#ff7600"},hashes:{frames:{[r.Landscape]:"28846",[r.Portrait]:"18461",[r.Square]:"24840"},logos:{[e.AzioneInteressePubblico]:"12481",[e.AzioneInterna]:"07462",[e.AzioneInternazionale]:"62091",[e.AzioneNuoveGenerazioni]:"28340",[e.AzioneProfessionale]:"32990",[e.Cultura]:"57135",[e.Distretto]:"01940",[e.Doc]:"20572",[e.Etruria]:"25935",[e.FondazioneRotary]:"41211",[e.Galileo]:"28425",[e.Magnifico]:"54002",[e.Montalbano]:"03570",[e.Sport]:"32507",[e.Tirreno]:"48765"}}};function z(){return typeof OffscreenCanvas<"u"}function v(n,o){if(z())return new OffscreenCanvas(n,o);const i=document.createElement("canvas");return i.width=n,i.height=o,i}const M=R();async function x(n,o,i,s,l,d){const h=new S(n,o);h.drawImage(i),h.drawFrame(s,l);for(const g of d)h.drawLogo(g,l??t.colors[e.Distretto]);return new URL(URL.createObjectURL(await h.getBlobAndDestroy()))}class S{constructor(o,i){b(this,u);b(this,f);b(this,c);b(this,w,0);m(this,f,v(o,i));const s=a(this,f).getContext("2d");if(!s)throw new Error("Canvas 2D rendering context not supported");m(this,c,s)}drawImage(o){const i=t.frame.border,s=t.frame.border,l=a(this,f).width-t.frame.border*2,d=a(this,f).height-t.frame.border*2;a(this,c).drawImage(o,i,s,l,d)}drawFrame(o,i){for(const s of o.paths)a(this,c).fillStyle=i!==null&&s.customizable?i:s.fill,a(this,c).fill(new Path2D(s.definition))}drawLogo(o,i){const[s,l]=p(this,u,P).call(this),[d,h]=p(this,u,C).call(this,s,l);p(this,u,E).call(this,d,h,i),a(this,c).drawImage(o,d,h,t.logo.image.side,t.logo.image.side),I(this,w)._++}async getBlobAndDestroy(){const o=a(this,f);if(z()&&o instanceof OffscreenCanvas)return o.convertToBlob();if(o instanceof HTMLCanvasElement)return new Promise((i,s)=>{o.toBlob(l=>{if(!l){s(new Error("Canvas.toBlob returned null"));return}o.remove(),i(l)})});throw new Error("Unsupported canvas type")}}f=new WeakMap,c=new WeakMap,w=new WeakMap,u=new WeakSet,P=function(){switch(a(this,w)){case 0:return[-1,1];case 1:return[1,-1];default:const o=-Math.PI/4-Math.PI/2*a(this,w);return[Math.cos,Math.sin].map(i=>Math.sign(i(o)))}},C=function(o,i){const s=t.frame.border+t.logo.circle.margin,l=t.logo.image.side,d=o<0?s:a(this,f).width-s-l,h=i>0?s:a(this,f).height-s-l;return[d,h]},E=function(o,i,s){const l=o+t.logo.image.side/2,d=i+t.logo.image.side/2;a(this,c).beginPath(),a(this,c).arc(l,d,M+t.logo.circle.strokeWidth,0,Math.PI*2),a(this,c).closePath(),a(this,c).fillStyle=s,a(this,c).fill(),a(this,c).beginPath(),a(this,c).arc(l,d,M,0,Math.PI*2),a(this,c).closePath(),a(this,c).fillStyle=t.logo.circle.color,a(this,c).fill()};function R(){return Math.ceil(Math.ceil(t.logo.image.side/2*Math.sqrt(2))/2)*2+t.logo.circle.padding+Math.floor(t.logo.circle.strokeWidth/2)}addEventListener("message",async n=>{const{width:o,height:i,images:s,frame:l,color:d,logos:h}=n.data;s.forEach(async g=>{postMessage({id:g.id,url:(await x(o,i,await createImageBitmap(await(await fetch(g.url)).blob(),g.x,g.y,g.width,g.height),l,d,h)).href})})})})();
