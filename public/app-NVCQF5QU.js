var ve=Object.create;var Z=Object.defineProperty;var pe=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var Ee=Object.getPrototypeOf,ye=Object.prototype.hasOwnProperty;var we=(l,u)=>()=>(u||l((u={exports:{}}).exports,u),u.exports);var be=(l,u,c,p)=>{if(u&&typeof u=="object"||typeof u=="function")for(let g of ge(u))!ye.call(l,g)&&g!==c&&Z(l,g,{get:()=>u[g],enumerable:!(p=pe(u,g))||p.enumerable});return l};var xe=(l,u,c)=>(c=l!=null?ve(Ee(l)):{},be(u||!l||!l.__esModule?Z(c,"default",{value:l,enumerable:!0}):c,l));var ee=we((j,G)=>{(function(l,u){typeof j=="object"&&typeof G<"u"?G.exports=u():typeof define=="function"&&define.amd?define(u):l.Croppr=u()})(j,function(){"use strict";(function(){for(var s=0,n=["ms","moz","webkit","o"],e=0;e<n.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[n[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[e]+"CancelAnimationFrame"]||window[n[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var o=new Date().getTime(),a=Math.max(0,16-(o-s)),r=window.setTimeout(function(){t(o+a)},a);return s=o+a,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})})(),function(){if(typeof window.CustomEvent=="function")return!1;function s(n,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var t=document.createEvent("CustomEvent");return t.initCustomEvent(n,e.bubbles,e.cancelable,e.detail),t}s.prototype=window.Event.prototype,window.CustomEvent=s}(),function(s){try{return new CustomEvent("test"),!1}catch{}function n(e,t){t=t||{bubbles:!1,cancelable:!1};var i=document.createEvent("MouseEvent");return i.initMouseEvent(e,t.bubbles,t.cancelable,s,0,0,0,0,0,!1,!1,!1,!1,0,null),i}n.prototype=Event.prototype,s.MouseEvent=n}(window);var l=function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")},u=function(){function s(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(n,e,t){return e&&s(n.prototype,e),t&&s(n,t),n}}(),c=function s(n,e,t){n===null&&(n=Function.prototype);var i=Object.getOwnPropertyDescriptor(n,e);if(i===void 0){var o=Object.getPrototypeOf(n);return o===null?void 0:s(o,e,t)}else{if("value"in i)return i.value;var a=i.get;return a===void 0?void 0:a.call(t)}},p=function(s,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof n);s.prototype=Object.create(n&&n.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(s,n):s.__proto__=n)},g=function(s,n){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n&&(typeof n=="object"||typeof n=="function")?n:s},I=function(){function s(n,e){var t=[],i=!0,o=!1,a=void 0;try{for(var r=n[Symbol.iterator](),h;!(i=(h=r.next()).done)&&(t.push(h.value),!(e&&t.length===e));i=!0);}catch(d){o=!0,a=d}finally{try{!i&&r.return&&r.return()}finally{if(o)throw a}}return t}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return s(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),V=function s(n,e,t,i){l(this,s);var o=this;this.position=n,this.constraints=e,this.cursor=t,this.eventBus=i,this.el=document.createElement("div"),this.el.className="croppr-handle",this.el.style.cursor=t,this.el.addEventListener("mousedown",a);function a(d){d.stopPropagation(),document.addEventListener("mouseup",r),document.addEventListener("mousemove",h),o.eventBus.dispatchEvent(new CustomEvent("handlestart",{detail:{handle:o}}))}function r(d){d.stopPropagation(),document.removeEventListener("mouseup",r),document.removeEventListener("mousemove",h),o.eventBus.dispatchEvent(new CustomEvent("handleend",{detail:{handle:o}}))}function h(d){d.stopPropagation(),o.eventBus.dispatchEvent(new CustomEvent("handlemove",{detail:{mouseX:d.clientX,mouseY:d.clientY}}))}},H=function(){function s(n,e,t,i){l(this,s),this.x1=n,this.y1=e,this.x2=t,this.y2=i}return u(s,[{key:"set",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return this.x1=e??this.x1,this.y1=t??this.y1,this.x2=i??this.x2,this.y2=o??this.y2,this}},{key:"width",value:function(){return Math.abs(this.x2-this.x1)}},{key:"height",value:function(){return Math.abs(this.y2-this.y1)}},{key:"resize",value:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0],o=this.x1+this.width()*i[0],a=this.y1+this.height()*i[1];return this.x1=o-e*i[0],this.y1=a-t*i[1],this.x2=this.x1+e,this.y2=this.y1+t,this}},{key:"scale",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],i=this.width()*e,o=this.height()*e;return this.resize(i,o,t),this}},{key:"move",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=this.width(),o=this.height();return e=e===null?this.x1:e,t=t===null?this.y1:t,this.x1=e,this.y1=t,this.x2=e+i,this.y2=t+o,this}},{key:"getRelativePoint",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0],t=this.width()*e[0],i=this.height()*e[1];return[t,i]}},{key:"getAbsolutePoint",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0],t=this.x1+this.width()*e[0],i=this.y1+this.height()*e[1];return[t,i]}},{key:"constrainToRatio",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"height";if(e!==null){var o=this.width(),a=this.height();switch(i){case"height":this.resize(this.width(),this.width()*e,t);break;case"width":this.resize(this.height()*1/e,this.height(),t);break;default:this.resize(this.width(),this.width()*e,t)}return this}}},{key:"constrainToBoundary",value:function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0],o=this.getAbsolutePoint(i),a=I(o,2),r=a[0],h=a[1],d=r,v=h,m=e-r,E=t-h,w=-2*i[0]+1,y=-2*i[1]+1,f=null,b=null;switch(w){case-1:f=d;break;case 0:f=Math.min(d,m)*2;break;case 1:f=m;break}switch(y){case-1:b=v;break;case 0:b=Math.min(v,E)*2;break;case 1:b=E;break}if(this.width()>f){var x=f/this.width();this.scale(x,i)}if(this.height()>b){var M=b/this.height();this.scale(M,i)}return this}},{key:"constrainToSize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0,0],r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;if(r&&(r>1?(e=t*1/r,o=o*r):r<1&&(t=e*r,i=o*1/r)),e&&this.width()>e){var h=e,d=r===null?this.height():t;this.resize(h,d,a)}if(t&&this.height()>t){var v=r===null?this.width():e,m=t;this.resize(v,m,a)}if(i&&this.width()<i){var E=i,w=r===null?this.height():o;this.resize(E,w,a)}if(o&&this.height()<o){var y=r===null?this.width():i,f=o;this.resize(y,f,a)}return this}}]),s}();function q(s){s.addEventListener("touchstart",P),s.addEventListener("touchend",P),s.addEventListener("touchmove",P)}function P(s){s.preventDefault();var n=s.changedTouches[0],e={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"};n.target.dispatchEvent(new MouseEvent(e[s.type],{bubbles:!0,cancelable:!0,view:window,clientX:n.clientX,clientY:n.clientY,screenX:n.screenX,screenY:n.screenY}))}var k=[{position:[0,0],constraints:[1,0,0,1],cursor:"nw-resize"},{position:[.5,0],constraints:[1,0,0,0],cursor:"n-resize"},{position:[1,0],constraints:[1,1,0,0],cursor:"ne-resize"},{position:[1,.5],constraints:[0,1,0,0],cursor:"e-resize"},{position:[1,1],constraints:[0,1,1,0],cursor:"se-resize"},{position:[.5,1],constraints:[0,0,1,0],cursor:"s-resize"},{position:[0,1],constraints:[0,0,1,1],cursor:"sw-resize"},{position:[0,.5],constraints:[0,0,0,1],cursor:"w-resize"}],W=function(){function s(n,e){var t=this,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(l(this,s),this.options=s.parseOptions(e||{}),!n.nodeName&&(n=document.querySelector(n),n==null))throw"Unable to find element.";if(!n.getAttribute("src"))throw"Image src not provided.";this._initialized=!1,this._restore={parent:n.parentNode,element:n},i||(n.width===0||n.height===0?n.onload=function(){t.initialize(n)}:this.initialize(n))}return u(s,[{key:"initialize",value:function(e){this.createDOM(e),this.options.convertToPixels(this.cropperEl),this.attachHandlerEvents(),this.attachRegionEvents(),this.attachOverlayEvents(),this.box=this.initializeBox(this.options),this.redraw(),this._initialized=!0,this.options.onInitialize!==null&&this.options.onInitialize(this)}},{key:"createDOM",value:function(e){this.containerEl=document.createElement("div"),this.containerEl.className="croppr-container",this.eventBus=this.containerEl,q(this.containerEl),this.cropperEl=document.createElement("div"),this.cropperEl.className="croppr",this.imageEl=document.createElement("img"),this.imageEl.setAttribute("src",e.getAttribute("src")),this.imageEl.setAttribute("alt",e.getAttribute("alt")),this.imageEl.className="croppr-image",this.imageClippedEl=this.imageEl.cloneNode(),this.imageClippedEl.className="croppr-imageClipped",this.regionEl=document.createElement("div"),this.regionEl.className="croppr-region",this.overlayEl=document.createElement("div"),this.overlayEl.className="croppr-overlay";var t=document.createElement("div");t.className="croppr-handleContainer",this.handles=[];for(var i=0;i<k.length;i++){var o=new V(k[i].position,k[i].constraints,k[i].cursor,this.eventBus);this.handles.push(o),t.appendChild(o.el)}this.cropperEl.appendChild(this.imageEl),this.cropperEl.appendChild(this.imageClippedEl),this.cropperEl.appendChild(this.regionEl),this.cropperEl.appendChild(this.overlayEl),this.cropperEl.appendChild(t),this.containerEl.appendChild(this.cropperEl),e.parentElement.replaceChild(this.containerEl,e)}},{key:"setImage",value:function(e){var t=this;return this.imageEl.onload=function(){t.box=t.initializeBox(t.options),t.redraw()},this.imageEl.src=e,this.imageClippedEl.src=e,this}},{key:"destroy",value:function(){this._restore.parent.replaceChild(this._restore.element,this.containerEl)}},{key:"initializeBox",value:function(e){var t=e.startSize.width,i=e.startSize.height,o=new H(0,0,t,i);o.constrainToRatio(e.aspectRatio,[.5,.5]);var a=e.minSize,r=e.maxSize;o.constrainToSize(r.width,r.height,a.width,a.height,[.5,.5],e.aspectRatio);var h=this.cropperEl.offsetWidth,d=this.cropperEl.offsetHeight;o.constrainToBoundary(h,d,[.5,.5]);var v=this.cropperEl.offsetWidth/2-o.width()/2,m=this.cropperEl.offsetHeight/2-o.height()/2;return o.move(v,m),o}},{key:"redraw",value:function(){var e=this,t=Math.round(this.box.width()),i=Math.round(this.box.height()),o=Math.round(this.box.x1),a=Math.round(this.box.y1),r=Math.round(this.box.x2),h=Math.round(this.box.y2);window.requestAnimationFrame(function(){e.regionEl.style.transform="translate("+o+"px, "+a+"px)",e.regionEl.style.width=t+"px",e.regionEl.style.height=i+"px",e.imageClippedEl.style.clip="rect("+a+"px, "+r+"px, "+h+"px, "+o+"px)";for(var d=e.box.getAbsolutePoint([.5,.5]),v=d[0]-e.cropperEl.offsetWidth/2>>31,m=d[1]-e.cropperEl.offsetHeight/2>>31,E=(v^m)+m+m+4,w=-2*E+8,y=0;y<e.handles.length;y++){var f=e.handles[y],b=f.el.offsetWidth,x=f.el.offsetHeight,M=o+t*f.position[0]-b/2,z=a+i*f.position[1]-x/2;f.el.style.transform="translate("+Math.round(M)+"px, "+Math.round(z)+"px)",f.el.style.zIndex=w==y?5:4}})}},{key:"attachHandlerEvents",value:function(){var e=this.eventBus;e.addEventListener("handlestart",this.onHandleMoveStart.bind(this)),e.addEventListener("handlemove",this.onHandleMoveMoving.bind(this)),e.addEventListener("handleend",this.onHandleMoveEnd.bind(this))}},{key:"attachRegionEvents",value:function(){var e=this.eventBus,t=this;this.regionEl.addEventListener("mousedown",i),e.addEventListener("regionstart",this.onRegionMoveStart.bind(this)),e.addEventListener("regionmove",this.onRegionMoveMoving.bind(this)),e.addEventListener("regionend",this.onRegionMoveEnd.bind(this));function i(r){r.stopPropagation(),document.addEventListener("mouseup",a),document.addEventListener("mousemove",o),e.dispatchEvent(new CustomEvent("regionstart",{detail:{mouseX:r.clientX,mouseY:r.clientY}}))}function o(r){r.stopPropagation(),e.dispatchEvent(new CustomEvent("regionmove",{detail:{mouseX:r.clientX,mouseY:r.clientY}}))}function a(r){r.stopPropagation(),document.removeEventListener("mouseup",a),document.removeEventListener("mousemove",o),e.dispatchEvent(new CustomEvent("regionend",{detail:{mouseX:r.clientX,mouseY:r.clientY}}))}}},{key:"attachOverlayEvents",value:function(){var e=4,t=this,i=null;this.overlayEl.addEventListener("mousedown",o);function o(h){h.stopPropagation(),document.addEventListener("mouseup",r),document.addEventListener("mousemove",a);var d=t.cropperEl.getBoundingClientRect(),v=h.clientX-d.left,m=h.clientY-d.top;i=t.box,t.box=new H(v,m,v+1,m+1),t.eventBus.dispatchEvent(new CustomEvent("handlestart",{detail:{handle:t.handles[e]}}))}function a(h){h.stopPropagation(),t.eventBus.dispatchEvent(new CustomEvent("handlemove",{detail:{mouseX:h.clientX,mouseY:h.clientY}}))}function r(h){if(h.stopPropagation(),document.removeEventListener("mouseup",r),document.removeEventListener("mousemove",a),t.box.width()===1&&t.box.height()===1){t.box=i;return}t.eventBus.dispatchEvent(new CustomEvent("handleend",{detail:{mouseX:h.clientX,mouseY:h.clientY}}))}}},{key:"onHandleMoveStart",value:function(e){var t=e.detail.handle,i=[1-t.position[0],1-t.position[1]],o=this.box.getAbsolutePoint(i),a=I(o,2),r=a[0],h=a[1];this.activeHandle={handle:t,originPoint:i,originX:r,originY:h},this.options.onCropStart!==null&&this.options.onCropStart(this.getValue())}},{key:"onHandleMoveMoving",value:function(e){var t=e.detail,i=t.mouseX,o=t.mouseY,a=this.cropperEl.getBoundingClientRect();i=i-a.left,o=o-a.top,i<0?i=0:i>a.width&&(i=a.width),o<0?o=0:o>a.height&&(o=a.height);var r=this.activeHandle.originPoint.slice(),h=this.activeHandle.originX,d=this.activeHandle.originY,v=this.activeHandle.handle,m=v.constraints[0]===1,E=v.constraints[1]===1,w=v.constraints[2]===1,y=v.constraints[3]===1,f=(y||E)&&(m||w),b=y||E?h:this.box.x1,x=y||E?h:this.box.x2,M=m||w?d:this.box.y1,z=m||w?d:this.box.y2;b=y?i:b,x=E?i:x,M=m?o:M,z=w?o:z;var _=!1,A=!1;if((y||E)&&(_=y?i>h:i<h),(m||w)&&(A=m?o>d:o<d),_){var C=b;b=x,x=C,r[0]=1-r[0]}if(A){var de=M;M=z,z=de,r[1]=1-r[1]}var R=new H(b,M,x,z);if(this.options.aspectRatio){var U=this.options.aspectRatio,N=!1;f?N=o>R.y1+U*R.width()||o<R.y2-U*R.width():(m||w)&&(N=!0);var ce=N?"width":"height";R.constrainToRatio(U,r,ce)}var Q=this.options.minSize,J=this.options.maxSize;R.constrainToSize(J.width,J.height,Q.width,Q.height,r,this.options.aspectRatio);var me=this.cropperEl.offsetWidth,fe=this.cropperEl.offsetHeight;R.constrainToBoundary(me,fe,r),this.box=R,this.redraw(),this.options.onCropMove!==null&&this.options.onCropMove(this.getValue())}},{key:"onHandleMoveEnd",value:function(e){this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue())}},{key:"onRegionMoveStart",value:function(e){var t=e.detail,i=t.mouseX,o=t.mouseY,a=this.cropperEl.getBoundingClientRect();i=i-a.left,o=o-a.top,this.currentMove={offsetX:i-this.box.x1,offsetY:o-this.box.y1},this.options.onCropStart!==null&&this.options.onCropStart(this.getValue())}},{key:"onRegionMoveMoving",value:function(e){var t=e.detail,i=t.mouseX,o=t.mouseY,a=this.currentMove,r=a.offsetX,h=a.offsetY,d=this.cropperEl.getBoundingClientRect();i=i-d.left,o=o-d.top,this.box.move(i-r,o-h),this.box.x1<0&&this.box.move(0,null),this.box.x2>d.width&&this.box.move(d.width-this.box.width(),null),this.box.y1<0&&this.box.move(null,0),this.box.y2>d.height&&this.box.move(null,d.height-this.box.height()),this.redraw(),this.options.onCropMove!==null&&this.options.onCropMove(this.getValue())}},{key:"onRegionMoveEnd",value:function(e){this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue())}},{key:"getValue",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(e===null&&(e=this.options.returnMode),e=="real"){var t=this.imageEl.naturalWidth,i=this.imageEl.naturalHeight,o=this.imageEl.getBoundingClientRect(),a=o.width,r=o.height,h=t/a,d=i/r;return{x:Math.round(this.box.x1*h),y:Math.round(this.box.y1*d),width:Math.round(this.box.width()*h),height:Math.round(this.box.height()*d)}}else if(e=="ratio"){var v=this.imageEl.getBoundingClientRect(),m=v.width,E=v.height;return{x:F(this.box.x1/m,3),y:F(this.box.y1/E,3),width:F(this.box.width()/m,3),height:F(this.box.height()/E,3)}}else if(e=="raw")return{x:Math.round(this.box.x1),y:Math.round(this.box.y1),width:Math.round(this.box.width()),height:Math.round(this.box.height())}}}],[{key:"parseOptions",value:function(e){var t={aspectRatio:null,maxSize:{width:null,height:null},minSize:{width:null,height:null},startSize:{width:100,height:100,unit:"%"},returnMode:"real",onInitialize:null,onCropStart:null,onCropMove:null,onCropEnd:null},i=null;e.aspectRatio!==void 0&&(typeof e.aspectRatio=="number"?i=e.aspectRatio:e.aspectRatio instanceof Array&&(i=e.aspectRatio[1]/e.aspectRatio[0]));var o=null;e.maxSize!==void 0&&e.maxSize!==null&&(o={width:e.maxSize[0]||null,height:e.maxSize[1]||null,unit:e.maxSize[2]||"px"});var a=null;e.minSize!==void 0&&e.minSize!==null&&(a={width:e.minSize[0]||null,height:e.minSize[1]||null,unit:e.minSize[2]||"px"});var r=null;e.startSize!==void 0&&e.startSize!==null&&(r={width:e.startSize[0]||null,height:e.startSize[1]||null,unit:e.startSize[2]||"%"});var h=null;typeof e.onInitialize=="function"&&(h=e.onInitialize);var d=null;typeof e.onCropStart=="function"&&(d=e.onCropStart);var v=null;typeof e.onCropEnd=="function"&&(v=e.onCropEnd);var m=null;typeof e.onUpdate=="function"&&(console.warn("Croppr.js: `onUpdate` is deprecated and will be removed in the next major release. Please use `onCropMove` or `onCropEnd` instead."),m=e.onUpdate),typeof e.onCropMove=="function"&&(m=e.onCropMove);var E=null;if(e.returnMode!==void 0){var w=e.returnMode.toLowerCase();if(["real","ratio","raw"].indexOf(w)===-1)throw"Invalid return mode.";E=w}var y=function(x){for(var M=x.offsetWidth,z=x.offsetHeight,_=["maxSize","minSize","startSize"],A=0;A<_.length;A++){var C=_[A];this[C]!==null&&(this[C].unit=="%"&&(this[C].width!==null&&(this[C].width=this[C].width/100*M),this[C].height!==null&&(this[C].height=this[C].height/100*z)),delete this[C].unit)}},f=function(x,M){return x!==null?x:M};return{aspectRatio:f(i,t.aspectRatio),maxSize:f(o,t.maxSize),minSize:f(a,t.minSize),startSize:f(r,t.startSize),returnMode:f(E,t.returnMode),onInitialize:f(h,t.onInitialize),onCropStart:f(d,t.onCropStart),onCropMove:f(m,t.onCropMove),onCropEnd:f(v,t.onCropEnd),convertToPixels:y}}}]),s}();function F(s,n){return+(Math.round(s+"e"+n)+"e-"+n)}var he=function(s){p(n,s);function n(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return l(this,n),g(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,i))}return u(n,[{key:"getValue",value:function(t){return c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"getValue",this).call(this,t)}},{key:"setImage",value:function(t){return c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setImage",this).call(this,t)}},{key:"destroy",value:function(){return c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this)}},{key:"moveTo",value:function(t,i){return this.box.move(t,i),this.redraw(),this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue()),this}},{key:"resizeTo",value:function(t,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[.5,.5];return this.box.resize(t,i,o),this.redraw(),this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue()),this}},{key:"scaleBy",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.5,.5];return this.box.scale(t,i),this.redraw(),this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue()),this}},{key:"reset",value:function(){return this.box=this.initializeBox(this.options),this.redraw(),this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue()),this}}]),n}(W);return he})});var te=xe(ee());var S={canvas:{shortSide:1080,longSide:1620},frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,color:"white",strokeWidth:8}},colors:{distretto:"#d41367",doc:"#0d4e8c",etruria:"#17b2dc",galileo:"#f5a14d",magnifico:"#138a62",montalbano:"#e71d75",tirreno:"#ee7046"},hashes:{frames:{landscape:"28846",portrait:"18461",square:"24840"},logos:{distretto:"06365",doc:"36231",etruria:"08921",galileo:"45306",magnifico:"13043",montalbano:"16037",tirreno:"63195"}}};var ne={square:1,landscape:(S.canvas.shortSide-S.frame.border*2)/(S.canvas.longSide-S.frame.border*2),portrait:(S.canvas.longSide-S.frame.border*2)/(S.canvas.shortSide-S.frame.border*2)};function ie(l,u){return new te.default(l,{aspectRatio:ne[u]})}function oe(l,u){l.options.aspectRatio=ne[u],l.reset()}var Ce={0:{hidden:!1,ariaBusy:"true",disabled:!0},1:{hidden:!1,ariaBusy:"false",disabled:!1},2:{hidden:!1,ariaBusy:"false",disabled:!0},3:{hidden:!0,ariaBusy:"false",disabled:!1}};function L(l,u){let{hidden:c,ariaBusy:p,disabled:g}=Ce[u];l.hidden=c,l.ariaBusy=p,l.disabled=g}function re(l){return{paths:Array.from(l.getElementsByTagName("path")).map(u=>{let c=u.getAttribute("d");if(c===null)throw new Error("missing path definition");let p=u.getAttribute("fill");if(p===null)throw new Error("missing default fill");return{definition:c,fill:p,customizable:u.classList.contains("customizable")}})}}async function ae(l,u){let c=document.createElement("a");c.href=l.href,c.download=u;let p=document.createElement("small");p.innerText="Clicca sull'immagine per scaricarla",c.appendChild(p);let g=new Image;return g.src=l.href,await g.decode(),c.appendChild(g),c}async function se(l){let u=await fetch(`/frames/${l}-${S.hashes.frames[l]}.svg`);return new DOMParser().parseFromString(await u.text(),"image/svg+xml").documentElement}var D=document.querySelector("form"),B=D.querySelector("fieldset"),$=B.querySelector('input[name="images"]'),X=B.querySelector('select[name="format"]'),le=B.querySelector('select[name="logo"]'),T=D.querySelector("button"),K=document.getElementById("croppers"),O=new Array,ue=new Worker("worker-6QFWWSKU.js");function Y(){for(let{cropper:l}of O)l.destroy();K.innerHTML="",O.length=0}var Se="Si \xE8 verificato un errore, riprova con Google Chrome da PC o Android.";$.addEventListener("change",async()=>{if(Y(),L(T,2),!$.files?.length)return;B.disabled=!0,L(T,0);let l=X.value;for(let u of $.files){let c=new Image,p=new URL(URL.createObjectURL(u));c.src=p.href;try{await c.decode()}catch{alert(Se),Y(),L(T,2),B.disabled=!1;return}K.appendChild(c),O.push({file:u,url:p,cropper:ie(c,l)})}L(T,1),B.disabled=!1});X.addEventListener("change",()=>{for(let{cropper:l}of O)oe(l,X.value)});D.addEventListener("submit",async l=>{l.preventDefault(),L(T,0);let u=X.value,c=await se(u),p=re(c),g=le.value!==""?le.value:null;ue.postMessage({format:u,images:O.map(({file:I,url:V,cropper:H})=>{let{x:q,y:P,width:k,height:W}=H.getValue();return{filename:I.name,url:V.href,x:q,y:P,width:k,height:W}}),frame:p,logo:g})});ue.addEventListener("message",async l=>{let u=l.data,c=await Promise.all(u.map(({url:p,filename:g})=>ae(new URL(p),g)));Y(),K.append(...c),L(T,3)});D.addEventListener("reset",()=>{Y(),L(T,2)});B.disabled=!1;
