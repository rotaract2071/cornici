var e={canvas:{shortSide:1080,longSide:1620},frame:{border:75},logo:{image:{side:118},circle:{margin:22,padding:4,color:"white",strokeWidth:8}},colors:{distretto:"#d41367",doc:"#0d4e8c",etruria:"#17b2dc",galileo:"#f5a14d",magnifico:"#138a62",montalbano:"#e71d75",tirreno:"#ee7046"},hashes:{frames:{landscape:"28846",portrait:"18461",square:"24840"},logos:{distretto:"06365",doc:"36231",etruria:"08921",galileo:"45306",magnifico:"13043",montalbano:"16037",tirreno:"63195"}}};async function g(t){let o=await fetch(`/logos/${t}-${e.hashes.logos[t]}.png`);return createImageBitmap(await o.blob())}var S={landscape:[e.canvas.longSide,e.canvas.shortSide],portrait:[e.canvas.shortSide,e.canvas.longSide],square:[e.canvas.shortSide,e.canvas.shortSide]},u=h(),p=C();async function f(t,o,n,r,i){let[a,s]=S[o.ratio],m=new OffscreenCanvas(a,s),l=m.getContext("2d");if(l===null)throw new Error("Canvas 2D rendering context is not supported");y(t,l,a,s),k(o,i,l);let c=0;return b(n,i??e.colors.distretto,c++,l,a,s),r!==null&&b(r,i,c++,l,a,s),URL.createObjectURL(await m.convertToBlob())}function y(t,o,n,r){o.drawImage(t,e.frame.border,e.frame.border,n-e.frame.border*2,r-e.frame.border*2)}function k(t,o,n){for(let r of t.paths)o!==null&&r.customizable?n.fillStyle=o:n.fillStyle=r.fill,n.fill(new Path2D(r.definition))}function b(t,o,n,r,i,a){let[s,m]=L(n),[l,c]=I(s,m,i,a);D(l,c,o,r);let[w,M]=P(s,m,i,a);r.drawImage(t,w,M,e.logo.image.side,e.logo.image.side)}function L(t){let o=-Math.PI/4-Math.PI/2*t;return[Math.cos,Math.sin].map(n=>Math.sign(n(o)))}function D(t,o,n,r){r.beginPath(),r.ellipse(t,o,u,u,0,0,Math.PI*2),r.closePath(),r.fillStyle=e.logo.circle.color,r.fill(),r.strokeStyle=n,r.lineWidth=e.logo.circle.strokeWidth,r.stroke()}function I(t,o,n,r){let i=h();return[n/2+t*(n/2-e.logo.circle.margin-Math.floor(e.logo.circle.strokeWidth/2)-i),r/2-o*(r/2-e.logo.circle.margin-Math.floor(e.logo.circle.strokeWidth/2)-i)]}function P(t,o,n,r){return[n/2+t*(n/2-p-(t>0?e.logo.image.side:0)),r/2-o*(r/2-p-(o<0?e.logo.image.side:0))]}function h(){return Math.ceil(Math.ceil(e.logo.image.side/2*Math.sqrt(2))/2)*2+e.logo.circle.padding+Math.floor(e.logo.circle.strokeWidth/2)}function C(){return e.logo.circle.margin+Math.floor(e.logo.circle.strokeWidth/2)+u-e.logo.image.side/2}addEventListener("message",async t=>{let{frame:o,images:n,logo:r}=t.data,i=await g("distretto"),a=r!==null?await g(r):null,s=r!==null?e.colors[r]:null,m=await Promise.all(n.map(async({file:l,bitmap:c})=>({filename:l.name,url:await f(c,o,i,a,s)})));postMessage(m)});
